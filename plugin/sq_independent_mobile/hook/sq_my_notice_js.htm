<script>

// 标记已读
var readOne = function(nid) { 
	// var jthis = $(node);
	var jnotice = $('.notice[data-nid=' + nid + ']');
	// var jnum = $("#nav-usernotice-unread-notices").text();//头部导航数值
	var postdata = {act: 'readone', nid: nid}; 
	// if(!jthis.hasClass('readbtn')) return false;
	$.xpost(xn.url('my-notice'), postdata, function(code, message) {
		if(code != 0) return $.alert(message);
		// jthis.removeClass('readbtn').text(message);
		jnotice.addClass('isread');
		// $('#nav-usernotice-unread-notices').text(--jnum);
		// jnum == 0 && $('#nav-usernotice').removeClass('current');
		var bubble = $('.sq-notice-bubble');
		bubble && bubble.remove();
		jnotice.find('.sq-icon-more').attr('isread', 1);
	});
};

// 点击a标签设置已读
$('.noticelist .notice').find('a').on('click', function() {
	// var isread_btn = $(this).parents('.notice').find('.readbtn');
	// isread_btn.length > 0 && isread_btn.trigger("click");
	var nid = $(this).parents('.notice').attr('data-nid');
	readOne(nid);
});

//删除单条
var deleteOne = function(nid) {
    // var jthis = $(this);
	// var jnum = $("#nav-usernotice-unread-notices").text();//头部导航数值
	var postdata = {act: 'delete', nid: nid};
	$.confirm('是否删除本条消息？', function() {
		$.xpost(xn.url('my-notice'), postdata, function(code, message) {
			if(code != 0) return $.alert(message);
			// jthis.prev().hasClass('readbtn') && $('#nav-usernotice-unread-notices').text(--jnum);
			// jnum == 0 && $('#nav-usernotice').removeClass('current');
			$('.notice[data-nid=' + nid + ']').remove();
			var bubble = $('.sq-notice-bubble');
			bubble && bubble.remove();
		});
	});
	
};

// 全部已读
$('#readall').on('click', function() {   
	var jthis = $(this);
	var postdata = {act: 'readall'};
	if(!jthis.hasClass('readall')) return false;
	$.xpost(xn.url('my-notice'), postdata, function(code, message) {
		if(code != 0) return $.alert(message);
		$('.noticelist .notice').addClass('isread');
		// $('.noticelist .notice').find('.readbtn').removeClass('readbtn').text(message.a);
		jthis.removeClass('readall').text(message.b);
		// $('#nav-usernotice').removeClass('current');//头部导航铃铛状态切换
	});	
});
// 删除本页信息
var jdelete = $('#delete');
jdelete.on('click', function() {   
	var text = $(this).data('confirm-text');
	$.confirm(text, function() {
		var jthis = $(this);
		var nidarr = $('.noticelist').data('nidarr');
		var postdata = {act: 'deletearr', nidarr: nidarr};
		$.xpost(xn.url('my-notice'), postdata, function(code, message) {
				jdelete.button(message);
				setTimeout(function() {
					window.location.reload();
				}, 1000);
		});	
	});
	return false;
})

</script>